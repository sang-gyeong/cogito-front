(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[271],{2559:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(77837),o=n(38860),u=n.n(o),c=n(2310),s=n(82684),a=n(34376),i=n(47384),f=n(92083),p=n.n(f),l=n(28598);function d(){var e,t,n,o=(0,a.useRouter)(),f=null===(e=o.query)||void 0===e?void 0:e.host,d=null===(t=o.query)||void 0===t?void 0:t.code,h=(n=(0,r.Z)(u().mark(function e(t,n){var r;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.hP)(t,n);case 2:if(r=e.sent){e.next=7;break}return window.alert("로그인에 실패하였습니다.\n잠시 후에 다시 시도해주세요"),o.replace("/login"),e.abrupt("return");case 7:(0,i.D$)("accessToken",r.accessToken),(0,i.D$)("expiresAt",p()().add(60,"minutes").format("yyyy-MM-DD HH:mm:ss")),!1===r.registered&&o.replace("/my"),o.replace("/");case 11:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)});return(0,s.useEffect)(function(){f&&d&&h(f,d)}),(0,l.jsx)(l.Fragment,{})}},2310:function(e,t,n){"use strict";n.d(t,{_J:function(){return c},hP:function(){return u},kS:function(){return s}});var r=n(46392),o=n(73380),u=function(e,t){return o.D2.get("/auth/".concat(e,"/login/token?code=").concat(t)).then(function(e){return null==e?void 0:e.data})},c=function(e){return r.ZP.post("/auth/reissue",{},{headers:{timeout:3e3,withCredentials:!0,Authorization:"Bearer ".concat(e)}}).then(function(e){return console.log("==="),null==e?void 0:e.data})},s=function(){return o.D2.post("/auth/logout").then(function(){return console.log("로그아웃 되었습니다.")})}},73380:function(e,t,n){"use strict";n.d(t,{D2:function(){return d},NJ:function(){return m},Rf:function(){return w},We:function(){return v}});var r=n(77837),o=n(38860),u=n.n(o),c=n(46392),s=n(92083),a=n.n(s),i=n(47384),f=n(2310);n(73788);var p,l,d=c.ZP.create({baseURL:"".concat("https://dev.cogito.shop","/api"),timeout:3e3,withCredentials:!0,headers:{}}),h=(p=(0,r.Z)(u().mark(function e(t){var n,r;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,f._J)(t);case 3:r=e.sent.accessToken,(0,i.D$)("accessToken",r),(0,i.D$)("expiresAt",a()().add(60,"minutes").format("yyyy-MM-DD HH:mm:ss")),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),window.localStorage.removeItem("accessToken"),window.localStorage.removeItem("expiresAt");case 13:case"end":return e.stop()}},e,null,[[0,9]])})),function(e){return p.apply(this,arguments)});d.interceptors.request.use((l=(0,r.Z)(u().mark(function e(t){var n,r,o;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(0,i.le)("expiresAt",a()().utc(!0).format("yyyy-MM-DD HH:mm:ss")),r=(0,i.le)("accessToken",""),!(t.headers&&20>=a()(n).diff(a()().utc(!0),"minutes"))){e.next=5;break}return e.next=5,h(r);case 5:return o=(0,i.le)("accessToken",""),t.headers&&o&&(t.headers.Authorization="Bearer ".concat(o)),e.abrupt("return",t);case 8:case"end":return e.stop()}},e)})),function(e){return l.apply(this,arguments)})),d.interceptors.response.use(function(e){return e},function(e){window.alert("로그인이 필요합니다")});var v=c.ZP.create({baseURL:"".concat("https://dev.cogito.shop","/api"),timeout:3e3,withCredentials:!0,headers:{"Content-type":"application/json"}});v.interceptors.response.use(function(e){return e},function(e){throw console.log("ssr axios error : ",e),Error(e)});var m=function(){return d.get("/tags").then(function(e){return null==e?void 0:e.data})},w=function(){return d.get("/users").then(function(e){return null==e?void 0:e.data})}},59501:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/[host]",function(){return n(2559)}])}},function(e){e.O(0,[217,774,888,179],function(){return e(e.s=59501)}),_N_E=e.O()}]);