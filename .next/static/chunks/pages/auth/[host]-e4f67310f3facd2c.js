(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[271],{2559:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return h}});var r=t(77837),o=t(38860),s=t.n(o),u=t(2310),a=t(82684),c=t(34376),i=t(47384),l=t(92083),f=t.n(l),d=t(73788),p=t(28598);function h(){var e,n,t,o=(0,c.useRouter)(),l=null===(e=o.query)||void 0===e?void 0:e.host,h=null===(n=o.query)||void 0===n?void 0:n.code,v=(t=(0,r.Z)(s().mark(function e(n,t){var r,a,c,l;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!n||!t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,(0,u.h)(n,t);case 4:if(r=e.sent){e.next=9;break}return window.alert("로그인에 실패하였습니다.\n잠시 후에 다시 시도해주세요"),o.replace("/login"),e.abrupt("return");case 9:a=r.accessToken,c=r.refreshToken,d.ZP.save("refreshToken",c,{}),(0,i.D$)("accessToken",a),(0,i.D$)("expiresAt",f()().add(30,"minutes").format("yyyy-MM-DD HH:mm:ss")),l=(0,i.St)("currentPath")||"/",o.replace(l);case 15:case"end":return e.stop()}},e)})),function(e,n){return t.apply(this,arguments)});return(0,a.useEffect)(function(){l&&h&&v(l,h)}),(0,p.jsx)(p.Fragment,{})}},2310:function(e,n,t){"use strict";t.d(n,{_:function(){return s},h:function(){return o}});var r=t(73380),o=function(e,n){return r.D2.get("/auth/".concat(e,"/login/token?code=").concat(n)).then(function(e){return null==e?void 0:e.data})},s=function(){return r.D2.get("/auth/reissue").then(function(e){return null==e?void 0:e.data})}},73380:function(e,n,t){"use strict";t.d(n,{D2:function(){return p},NJ:function(){return v},Rf:function(){return k},We:function(){return h}});var r,o=t(77837),s=t(38860),u=t.n(s),a=t(46392),c=t(92083),i=t.n(c),l=t(73788),f=t(47384),d=t(2310),p=a.ZP.create({baseURL:"".concat("https://dev.cogito.shop","/api"),timeout:3e3,withCredentials:!0,headers:{"Content-type":"application/json"}});p.interceptors.request.use((r=(0,o.Z)(u().mark(function e(n){var t,r,o,s;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.ZP.load("refreshToken"),r=(0,f.le)("expiresAt",i()().format("yyyy-MM-DD HH:mm:ss")),!(0>i()(r).diff(i()())&&t&&n.headers)){e.next=9;break}return n.headers.Authorization="Bearer ".concat(t),e.next=6,(0,d._)();case 6:o=e.sent,console.log("-----requestInterceptor reissueToken response : ",o),o&&((0,f.D$)("accessToken",o.accessToken),(0,f.D$)("expiresAt",i()().add(30,"minutes").format("yyyy-MM-DD HH:mm:ss")),l.ZP.save("refreshToken",o.refreshToken,{httpOnly:!0}));case 9:return s=(0,f.le)("accessToken",""),console.log("-----requestInterceptor refreshToken : ",t),console.log("-----requestInterceptor accessToken : ",s),n.headers&&s&&(n.headers.Authorization="Bearer ".concat(s)),e.abrupt("return",n);case 14:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})),p.interceptors.response.use(function(e){return e},function(e){var n,t,r,o,s;["A008","A011","A012","A013"].includes(null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.code)&&(l.ZP.remove("refreshToken"),null==globalThis||globalThis.localStorage.clear()),console.log("csr axios error : ",e),window.alert(null!==(r=null==e?void 0:null===(o=e.response)||void 0===o?void 0:null===(s=o.data)||void 0===s?void 0:s.message)&&void 0!==r?r:null==e?void 0:e.message)});var h=a.ZP.create({baseURL:"".concat("https://dev.cogito.shop","/api"),timeout:3e3,withCredentials:!0,headers:{"Content-type":"application/json"}});h.interceptors.response.use(function(e){return e},function(e){throw console.log("ssr axios error : ",e),Error(e)});var v=function(){return p.get("/tags").then(function(e){return null==e?void 0:e.data})},k=function(){return p.get("/users").then(function(e){return null==e?void 0:e.data})}},59501:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/[host]",function(){return t(2559)}])}},function(e){e.O(0,[217,774,888,179],function(){return e(e.s=59501)}),_N_E=e.O()}]);